[sssd]
config_file_version = 2
services = nss, pam, ssh, sudo
domains = <%= @domain %>

[nss]
filter_users = root,named,avahi,haldaemon,dbus,radiusd,news,nscd,centos,ubuntu

[pam]

[ssh]

[sudo]

[domain/<%= @domain %>]
<% if @enumerate %>
enumerate = true
<% end %>

id_provider = ad
access_provider = ad

ad_domain = <%= @domain %>
krb5_realm = <%= @realm %>
cache_credentials = True
krb5_store_password_if_offline = True
default_shell = /bin/bash
ldap_id_mapping = True
fallback_homedir = <%= node['sssd']['basedir']%>/%u

ldap_user_ssh_public_key = sshPublicKey

<% if node.sssd['custom_config'] %>
<% node.sssd['custom_config'].sort.each do |key, value| %>
<%= key %>=<%= value %>
<% end %>
<% end %>
